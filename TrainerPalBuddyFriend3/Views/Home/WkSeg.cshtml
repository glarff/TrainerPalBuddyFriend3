@model Danimoth

@if (Model.SelectedWorkout == null)
{
    using (Ajax.BeginForm("Form7", "Home", new AjaxOptions
    {
        HttpMethod = "POST",
        UpdateTargetId = "id1",
        LoadingElementId = "LoadingImage",
        OnSuccess = "onSuccess_Message",
        OnFailure = "onFailure_Message"
    }))
    {
        <h2>Select Workout</h2>
        <table id="myTbl" class="table table-condensed nestedtablewithactions" summary="Defined Types">
            <tr>
                <td>@Html.DropDownListFor(m => m.SelectedWorkout.Workoutpk, Model.DropDownList1)</td>
                <td><input id="submit1" type="submit" value="Select" /></td>
            </tr>
        </table>
    }

}

@if (Model.SelectedWorkout != null)
{

    using (Ajax.BeginForm("Form8", "Home", new AjaxOptions
    {
        HttpMethod = "POST",
        UpdateTargetId = "id1",
        LoadingElementId = "LoadingImage",
        OnSuccess = "onSuccess_Message",
        OnFailure = "onFailure_Message"
    }))
    {
        <h2>Add Segments</h2>
        <button type="button" class="addbtn" title="Remove row">Add</button>
        <table id="myTbl" class="table table-condensed nestedtablewithactions" summary="Defined Types">
            <tr>
                <th style="display:none">PK</th>
                <th style="display:none">FK</th>
                <th>Segment</th>
                <th>Duration (s)</th>
                <th>Sequence</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
            @{ 
                int i = 0;
                int j = 0;
             }
            @foreach (var r in Model.Dts)
            {
                <tr class="visibleRow">
                    <td class="pk" style="display:none">@Html.TextBoxFor(m => Model.Dts[i].rWkseg.Wksegpk)</td>
                    <td class="fk" style="display:none">@Html.TextBoxFor(m => Model.Dts[i].rWkseg.Workouts.Workoutpk)</td>
                    <td>@Html.DropDownListFor(m => Model.Dts[i].rWkseg.Segments, Model.Dts[i].rWkseg.DropDownList2)</td>
                    <td>@Html.TextBoxFor(m => Model.Dts[i].rWkseg.Duration)</td>
                    <td>@Html.TextBoxFor(m => Model.Dts[i].rWkseg.Sequence)</td>
                    <td><button type="button" class="editbtn" title="Edit row">Edit</button></td>
                    <td><button type="button" class="deletebtn" title="Remove row">X</button></td>
                </tr>
                i++;
            }

            @for (j = i; j < i + 5; j++)
            {
                // ugly solution until I can find something better that works
                // add invisible rows to handle additions
                var newRz = new Raszagal();

                var newRzWksg = new Wkseg();
                newRzWksg.DropDownList2 = Model.Dts[0].rWkseg.DropDownList2;

                newRz.rWkseg = newRzWksg;

                Model.Dts.Add(newRz);
                

                <tr class="hiddenRow">
                    <td class="pk" style="display:none">@Html.TextBoxFor(m => m.Dts[j].rWkseg.Wksegpk)</td>
                    <td class="fk" style="display:none">@Html.TextBoxFor(m => m.Dts[i].rWkseg.Workouts.Workoutpk)</td>
                    <td>@Html.DropDownListFor(m => m.Dts[j].rWkseg.Segments, Model.Dts[j].rWkseg.DropDownList2)</td>
                    <td>@Html.TextBoxFor(m => m.Dts[j].rWkseg.Duration)</td>
                    <td>@Html.TextBoxFor(m => m.Dts[j].rWkseg.Sequence)</td>
                    <td><button type="button" class="editbtn" title="Edit row">Edit</button></td>
                    <td><button type="button" class="deletebtn" title="Remove row">X</button></td>
                </tr>
            }
            <tr name="submitRow">
                <td colspan="6"><input type="submit" value="Save Changes" /></td>
            </tr>
        </table>

    }

}
